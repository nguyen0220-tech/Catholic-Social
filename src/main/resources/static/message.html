<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="icon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icon/favicon-16x16.png">
    <link rel="manifest" href="icon/site.webmanifest">
    <title>Chat</title>
    <style>
        :root {
            --primary-color: #007bff;
            --bg-light: #f5f7fa;
            --border-color: #ddd;
            --mine-bg: #dcf8c6;
            --other-bg: #f1f1f1;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            height: 100vh;
            background: var(--bg-light);
            overflow: hidden;
        }

        /* ===== MAIN CHAT AREA ===== */
        .chat-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: #fff;
        }

        /* ===== TOP BAR (G·ªôp Ti√™u ƒë·ªÅ & Search c≈©) ===== */
        .top-bar {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background: #fff;
            border-bottom: 1px solid var(--border-color);
            gap: 12px;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--primary-color);
        }

        .room-info { flex: 1; }
        .room-info h3 { margin: 0; font-size: 16px; color: #333; }

        .top-actions { display: flex; gap: 8px; }

        .icon-btn {
            background: #f0f2f5;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
        }
        .icon-btn:hover { background: #e4e6eb; }

        /* ===== MESSAGES AREA ===== */
        #messagesContainer {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .loading { text-align: center; padding: 10px; font-size: 13px; color: #888; }

        .message { display: flex; margin: 8px 0; max-width: 80%; gap: 8px; }
        .message.mine { align-self: flex-end; flex-direction: row-reverse; }
        .message .avatar { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
        .message .content { display: flex; flex-direction: column; }
        .message .bubble {
            padding: 8px 14px; border-radius: 18px; font-size: 14px;
            word-break: break-word; background: var(--other-bg);
        }
        .message.mine .bubble { background: var(--mine-bg); border-bottom-right-radius: 4px; }
        .message.other .bubble { border-bottom-left-radius: 4px; }
        .message .time { font-size: 10px; color: #888; margin-top: 4px; }

        /* Media in chat */
        .media-list { display: flex; gap: 6px; margin-top: 6px; flex-wrap: wrap; }
        .message-image { max-width: 160px; max-height: 160px; border-radius: 8px; cursor: pointer; object-fit: cover; }

        /* ===== RIGHT SIDEBAR ===== */
        .sidebar {
            width: 320px;
            border-left: 1px solid var(--border-color);
            background: #fff;
            display: none; /* S·∫Ω ƒë∆∞·ª£c m·ªü b·ªüi JS */
            flex-direction: column;
        }
        .sidebar-header {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .sidebar-content { padding: 15px; overflow-y: auto; flex: 1; }

        /* Search in Sidebar */
        .search-box-mini {
            display: flex;
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 4px 12px;
            margin-bottom: 15px;
        }
        .search-box-mini input { border: none; outline: none; flex: 1; padding: 6px; font-size: 13px; }
        .search-box-mini button { border: none; background: none; cursor: pointer; color: var(--primary-color); }

        /* Grid Media in Sidebar */
        .media-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
        .media-item-wrapper { aspect-ratio: 1; border-radius: 4px; overflow: hidden; }
        .media-item-wrapper img { width: 100%; height: 100%; object-fit: cover; }

        /* ===== BOTTOM BAR ===== */
        .bottom-section { padding: 10px; background: #fff; border-top: 1px solid var(--border-color); }
        .preview-container { display: flex; gap: 8px; padding: 5px; overflow-x: auto; }
        .preview-container img { width: 50px; height: 50px; border-radius: 6px; border: 1px solid var(--border-color); }

        .send-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #f0f2f5;
            padding: 6px 15px;
            border-radius: 25px;
        }
        #messageInput {
            flex: 1; border: none; background: transparent;
            padding: 8px; outline: none; font-size: 14px;
        }
        .file-btn { cursor: pointer; font-size: 20px; color: #666; }
        #sendBtn {
            background: none; border: none; color: var(--primary-color);
            font-weight: 600; cursor: pointer; padding: 5px;
        }

        .hidden { display: none !important; }

    </style>
</head>
<body>

<div class="chat-main">
    <div class="top-bar">
        <button class="back-btn" onclick="goBack()">‚Äπ</button>
        <div class="room-info">
            <h3 id="roomTitle">üí¨ Chat</h3>
        </div>
        <div class="top-actions">
            <button id="toggleMembersBtn" class="icon-btn" onclick="toggleSidebar('members')">üë• Th√†nh vi√™n</button>
            <button id="viewMediaBtn" class="icon-btn" onclick="toggleSidebar('media')">üñºÔ∏è Media</button>
        </div>
    </div>

    <div id="messagesContainer">
    </div>

    <div id="loading" class="loading">‚è≥ ƒêang t·∫£i tin nh·∫Øn...</div>

    <div class="bottom-section">
        <div id="previewContainer" class="preview-container"></div>
        <div class="send-bar">
            <label class="file-btn" title="G·ª≠i ·∫£nh">
                üìé <input id="mediaInput" type="file" multiple style="display:none">
            </label>
            <input id="messageInput" placeholder="Nh·∫≠p tin nh·∫Øn..." autocomplete="off">
            <button id="sendBtn">G·ª¨I</button>
        </div>
    </div>
</div>

<div id="rightSidebar" class="sidebar">
    <div class="sidebar-header">
        <span id="sidebarTitle">Th√¥ng tin</span>
        <button onclick="toggleSidebar()" style="border:none; background:none; cursor:pointer; font-size: 18px;">‚úï</button>
    </div>

    <div class="sidebar-content">
        <div id="membersSection" class="hidden">
            <div class="search-box-mini">
                <input id="searchUserInput" placeholder="T√¨m ng∆∞·ªùi d√πng...">
                <button id="searchUserBtn">üîç</button>
            </div>
            <div id="addMemberContainer"></div>
            <div id="addMemberLoading" class="loading">‚è≥ ƒêang t·∫£i th√†nh vi√™n...</div>
        </div>

        <div id="mediaSection" class="hidden">
            <div id="mediaContainer" class="media-grid"></div>
            <div id="mediaLoading" class="loading">‚è≥ ƒêang t·∫£i ·∫£nh...</div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="message.js"></script>

<script>
    // H√†m h·ªó tr·ª£ UI m·ªõi ƒë·ªÉ ƒë√≥ng m·ªü Sidebar
    function toggleSidebar(type) {
        const sidebar = document.getElementById('rightSidebar');
        const mSection = document.getElementById('membersSection');
        const mediaSection = document.getElementById('mediaSection');
        const title = document.getElementById('sidebarTitle');

        if (!type || (sidebar.style.display === 'flex' && sidebar.dataset.current === type)) {
            sidebar.style.display = 'none';
            sidebar.dataset.current = '';
        } else {
            sidebar.style.display = 'flex';
            sidebar.dataset.current = type;

            if (type === 'members') {
                title.innerText = "Th√†nh vi√™n";
                mSection.classList.remove('hidden');
                mediaSection.classList.add('hidden');
            } else {
                title.innerText = "File ph∆∞∆°ng ti·ªán";
                mSection.classList.add('hidden');
                mediaSection.classList.remove('hidden');
            }
        }
    }

    function goBack() {
        window.location.href = "chat-room.html";
    }
</script>
</body>
</html>